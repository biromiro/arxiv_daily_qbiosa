<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ArXiv Daily AI Paper Digest</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 font-sans">
  <div class="container mx-auto px-4 py-8">
    <h1 class="text-3xl font-bold text-center text-gray-800 mb-8">ArXiv Daily AI Paper Digest</h1>

    <div id="report-list" class="space-y-8">
      <p class="text-center text-gray-500">Loading report list...</p>
    </div>
  </div>

  <script>
    function groupByMonth(files) {
      const groups = {};
      files.forEach(file => {
        const dateStr = file.replace('.html', '').replace(/_/g, '-'); // YYYY-MM-DD
        const [year, month, day] = dateStr.split('-');
        const monthKey = `${year}-${month}`;
        if (!groups[monthKey]) groups[monthKey] = {};
        groups[monthKey][day] = { file, dateStr };
      });
      return groups;
    }

    async function loadReportLinks() {
      const reportListDiv = document.getElementById('report-list');
      reportListDiv.innerHTML = '';

      try {
        const response = await fetch('reports.json');
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
        const files = await response.json();

        if (files && files.length > 0) {
          files.sort().reverse(); // newest first
          const grouped = groupByMonth(files);

          for (const monthKey of Object.keys(grouped).sort().reverse()) {
            const monthDiv = document.createElement('div');
            monthDiv.className = 'space-y-2';

            const [year, month] = monthKey.split('-');
            const monthName = new Date(`${year}-${month}-01`).toLocaleString('default', { month: 'long', year: 'numeric' });

            const heading = document.createElement('h2');
            heading.textContent = monthName;
            heading.className = 'text-xl font-semibold text-gray-700 border-b pb-1 mb-2';
            monthDiv.appendChild(heading);

            const grid = document.createElement('div');
            grid.className = 'grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-2';

            for (const dayStr of Object.keys(grouped[monthKey]).sort().reverse()) {
              const { file, dateStr } = grouped[monthKey][dayStr];

              const jsonFile = `daily_json/${file.replace('.html', '.json')}`;
              try {
                const jsonResp = await fetch(jsonFile);
                let hasContent = false;
                if (jsonResp.ok) {
                  const papers = await jsonResp.json();
                  hasContent = Array.isArray(papers) && papers.length > 0;
                }

                if (hasContent) {
                  const link = document.createElement('a');
                  link.href = `daily_html/${file}`;
                  link.textContent = dateStr;
                  link.className = 'block bg-white p-2 rounded shadow text-center hover:bg-blue-50 transition';
                  grid.appendChild(link);
                } else {
                  const placeholder = document.createElement('div');
                  placeholder.textContent = `${dateStr} (No papers)`;
                  placeholder.className = 'block bg-gray-200 p-2 rounded text-center text-gray-500 italic';
                  grid.appendChild(placeholder);
                }
              } catch (err) {
                console.error(`Error fetching JSON for ${file}`, err);
              }
            }

            monthDiv.appendChild(grid);
            reportListDiv.appendChild(monthDiv);
          }
        } else {
          reportListDiv.innerHTML = '<p class="text-center text-red-500">No reports found. Please check that reports.json is being generated correctly.</p>';
        }

      } catch (error) {
        console.error('Error loading report list:', error);
        let errorMessage = `<p class="text-center text-red-500">Error loading report list: ${error.message}. Check console for details.</p>`;
        reportListDiv.innerHTML = errorMessage;
      }
    }

    document.addEventListener('DOMContentLoaded', loadReportLinks);
  </script>
</body>
</html>
