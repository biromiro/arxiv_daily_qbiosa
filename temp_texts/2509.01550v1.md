# Abstract

Root-mean-square deviation (RMSD) is widely used to assess structural similarity in systems ranging from flexible ligand conformers to complex molecular cluster configurations. Despite its wide utility, RMSD calculation is often challenged by inconsistent atom ordering, indistinguish- able configurations in molecular clusters, and potential chirality inversion during alignment. These issues highlight the necessity of accurate atom-to-atom correspondence as a prerequisite for meaningful alignment. Traditional approaches often rely on heuristic cost matrices com- bined with the Hungarian algorithm, yet these methods underutilize the rich intra-molecular In this structural information and may fail to generalize across chemically diverse systems. work, we introduce OTMol, a method that formulates the molecular alignment task as a fused supervised Gromov-Wasserstein (fsGW) optimal transport problem. By leveraging the intrin- sic geometric and topological relationships within each molecule, OTMol eliminates the need for manually defined cost functions and enables a principled, data-driven matching strategy. Importantly, OTMol preserves key chemical features such as molecular chirality and bond con- nectivity consistency. We evaluate OTMol across a wide range of molecular systems, including Adenosine triphosphate, Imatinib, lipids, small peptides, and water clusters, and demonstrate that it consistently achieves low RMSD values while preserving computational efficiency. Impor- tantly, OTMol maintains molecular integrity by enforcing one-to-one mappings between entire molecules, thereby avoiding erroneous many-to-one alignments that often arise in comparing molecular clusters. Our results underscore the utility of optimal transport theory for molecu- lar alignment and offer a generalizable framework applicable to structural comparison tasks in cheminformatics, molecular modeling, and related disciplines. Keywords: RMSD, supervised optimal transport, molecular superimposition

5 2 0 2

p e S 1

]

M B . o i b - q [

1 v 0 5 5 1 0 . 9 0 5 2 : v i X r a

1

# Introduction

The spatial arrangement of atoms in a molecular system determines its physical properties, chem- ical reactivity, and biological activity [1, 2]. With the continued advancement of experimental

†These authors contributed equally. ∗Correspondence: zcang@ncsu.edu, yingkai.zhang@nyu.edu.

1













techniques such as X-ray crystallography, NMR spectroscopy, and cryo-electron microscopy, high- resolution molecular structures are now being determined at scale. Simultaneously, the growth of machine learning–based generative models [3, 4, 5, 6, 7], cheminformatics tools like RDKit, and molecular dynamics simulations has led to an exponential expansion of in silico 3D molecu- lar datasets. Consequently, there is a growing need to accurately compare and align molecular structures.

Root-mean-square deviation (RMSD) is the most widely used metric for quantifying structural similarity. It plays a central role in conformer clustering, evaluating computational models, and identifying conserved structural motifs in molecular clusters. RMSD is also particularly useful for detecting redundancy in conformational ensembles [8, 9], and for benchmarking predicted structures against experimental references.

Despite its broad application, RMSD-based comparison often faces practical challenges. A major issue is inconsistent atom ordering [2], which can occur when structures are generated by different software tools or experimental pipelines. Another challenge arises from symmetric or indistinguish- able configurations, especially in molecular clusters such as water networks [10, 11] or noble gas assemblies [12, 13, 14, 15], where multiple equivalent atom mappings exist. Additionally, some alignment algorithms allow reflections [16], which can invert molecular chirality, an outcome that is chemically and biologically undesirable. These challenges underscore the need for molecular struc- ture comparison algorithms that are atom-order-independent, cluster-aware, and chirality-sensitive.

Alignment-based RMSD calculation requires identifying an optimal rigid-body transformation that minimizes atomic coordinate differences. Specifically, the superimposition of two molecules involves a rigid body transformation on the target molecule and aligning it to the reference molecule. When a one-to-one assignment of the atoms between the molecules is given, the optimal superimposition that has the lowest RMSD can be determined by the Kabsch algorithm [17] or the faster quater- nions [18]. Since different atom assignments often yield substantially different superimpositions and RMSD values, it is crucial to identify a proper one-to-one atom assignment. To ensure that the RMSD accurately reflects the similarity between the two molecules, researchers seek the assignment that yields the lowest possible RMSD after optimal alignment. In the case of two molecules with the same atomic composition, the atom assignment problem is equivalent to the problem of finding permutations of the target molecule. As the number of possible permutations of atoms is astro- nomical when the total number of atoms increases, naive approaches that brute-forcely evaluate all possible permutations are infeasible.

Many existing approaches [19, 20, 21, 22, 23, 24, 25] find the atom assignment by solving a lin- ear assignment problem [26]. These approaches first construct a cost matrix that quantifies the dissimilarity between atoms of the two molecules. Then, the Hungarian algorithm [27, 28] or the Jonker-Volgenant algorithm [29] is used to find a one-to-one atom assignment that minimizes the total assignment cost. A key challenge of solving a linear assignment problem in this context is the lack of a known cost matrix a priori. Existing approaches address this by constructing heuristic cost matrices based on atomic properties, which often lead to suboptimal alignment and inflated RMSD values. For example, ArbAlign [16] first performs coordinate transforms based on an in- trinsic coordinate axis system and obtains an initial coarse superimposition. The cost of matching atoms is defined by their Euclidean distance. ArbAlign also applies coordinate swaps and reflec- tions to generate additional initial superimpositions. An alternative coordinate transformation is proposed by Helmich and Sierka [20]. V´asquez-P´erez et al. [24] and Marques et al. [21] apply the Hungarian algorithm with randomly generated rigid body transformations and iteratively improve the RMSD. Inspired by shape matching approaches in computer vision, Richmond et al. [22] first

2

define a histogram for each atom that encodes local spatial information, and then calculate the cost of matching two atoms as a weighted sum of the difference of partial charges and the difference of the histograms.

The assignment problem solved by the Hungarian algorithm can be viewed as a special case of op- timal transport where the transport plan is restricted to permutation matrices. Here, we cast the problem of superimposing two molecules into a more general optimal transport problem. Conven- tional optimal transport in the Kantorovich form seeks a transport matrix which is also a probability matrix that minimizes the total transport cost based on a predefined inter-distribution cost. An im- portant recent extension of optimal transport is the Gromov-Wasserstein optimal transport [30, 31]. Unlike traditional optimal transport, the Gromov-Wasserstein problem aims to preserve the intra- distribution distances. Intuitively, the Gromov-Wasserstein problem matches spatially close (or spatially distant, respectively) atoms in molecule A to spatially close (or spatially distant, respec- tively) atoms in molecule B. This approach eliminates the need to define a cost matrix a priori. In this work, we apply Gromov–Wasserstein optimal transport to capture intra-molecular structural relationships, in contrast to existing methods that focus solely on inter-molecular distances.

Fundamental chemical principles impose inherent constraints on how molecules can be aligned. In practice, atom assignments often require certain atom categories or substructures to be matched. These chemistry constraints can be naturally incorporated into optimal transport formulations using the framework of supervised optimal transport (sOT) [32] and supervised Gromov-Wasserstein optimal transport (sGW) [33]. Specifically, the sOT framework allows elementwise constraints on the transport matrix. The sGW framework enforces structural consistency by constraining how much pairwise distances within each structure can be distorted during transport. Based on these recent optimal transport methods, we introduce OTMol, a computational tool for solving the molecular alignment problem. To ensure that atom labels match and utilize the intra-molecule structural information, we consider the fused supervised Gromov-Wasserstein (fsGW) problem, which combines sOT and sGW, addressing the atomic label costs and the molecular structure preservation, respectively. Moreover, OTMol can solve the alignment problem between clusters of atoms or molecules. In clusters of identical molecules, OTMol performs a hierarchical alignment by first assigning molecule pairs and then matching atoms within each pair, ensuring that atomic correspondences are restricted to their designated molecular matches.

The remainder of the paper is organized as follows. In section 2, we first formalize the align- ment problem and introduce the fused supervised Gromov–Wasserstein framework, which forms the mathematical foundation of OTMol. We then describe the OTMol algorithms for aligning indi- vidual molecules or clusters of identical atoms or molecules. Crucially, this framework is designed to overcome the core challenges identified above by ensuring that molecular alignment is atom- order-independent, cluster-aware, and chirality-sensitive, three essential properties for chemically meaningful structure comparison. In section 3, we compare the results of OTMol and ArbAlign, the state-of-the-art method for aligning molecules, on various benchmark datasets, including ATP, Imatinib, peptides, lipids, sugars, and water clusters. In 4, we outline future research directions on generalization to molecular analogs and macro-biomolecules.

2 Materials and Methods

In this section, we present the optimal transport problems related to OTMol. More details on general optimal transport background can be found in [32, 33, 34, 35].

3

2.1 Mathematical Statement of the Molecular Alignment Problem

Let A, B be two molecules of n atoms and their coordinates be xA be represented by a permutation matrix P. We consider the following optimization problem

i . An atom assignment can

i , xB

min P

min T





1 n

(cid:88)

i,j

Pij∥xA

i − T(xB

j )∥2 2



1 2



,

(1)

where T is a rigid body transformation (reflection not allowed) in the 3-dimensional space. Given a permutation matrix P, the Kabsch algorithm [17, 36, 37] finds a rigid body transformation T such that the RMSD





1 n

(cid:88)

i,j

Pij∥xA

i − T(xB

j )∥2 2



1 2



(2)

is minimized. Since the number of possible P is n!, the challenge is to find an approximate best permutation P in polynomial time. In addition, the permutation should also satisfy chemistry constraints.

2.2 Fused Supervised Gromov-Wasserstein Optimal Transport

Here we aim to approximate the optimal permutation by solving a Gromov-Wasserstein (GW) problem which seeks continuous transport plans preserving the pairwise structural relationships:

arg min P∈Γ

(cid:88)

i,j,k,l

(DA

ik − DB

jl)2PijPkl

(3)

+

: P1n = 1

n 1n, PT 1n = 1

where Γ = {P ∈ Rn×n n 1n} (1n is a vector of ones). Pij can be interpreted as the probability of assigning the i-th atom in A to the j-th atom in B. The distance matrices DA and DB encode the intra-molecular geometrical and structural information of molecules A, B, and we take a linear combination of Euclidean distance and graph geodesic distance. The objective function of GW penalizes large differences between DA jl, resulting in transport plans P that transport a pair of atoms in A to another pair of atoms in B whose distances are similar.

ik, DB

In this application, there are natural constraints on P depending on specific molecular structures and alignment problems. For example, atoms have labels such as element names and SYBYL types, and we often require the atom labels to match in the assignment. To enforce this constraint, we consider the following fused supervised Gromov-Wasserstein (fsGW) problem [32, 33]:

arg min P∈Γ

(1 − α)⟨C, P⟩F + α

(cid:88)

i,j,k,l

(DA

ik − DB

jl)2PijPkl

(4)

where α ∈ [0, 1] is a weight parameter balancing the Wasserstein term and Gromov-Wasserstein term, ⟨, ⟩F is the Frobenius product, and Cij = 0 if the atom i in A and atom j in B are of the same label, and Cij = ∞ otherwise. Such a cost matrix C prohibits label mismatch since a nonzero Pij between different labels would induce a infinite transport cost. When α = 0, the fsGW becomes a supervised optimal transport (sOT) problem.

4

Optimal transport problems require the input of marginal distributions a, b. In this work, we take a = b = 1 n 1n. Since a transport plan P is a probability matrix, we introduce a heuristic procedure to turn it into a permutation matrix P′ where P′ ij = 1 when j = arg maxk Pik, and we always check if P′ is a permutation matrix.

2.3 Aligning Single Molecules and Clusters of Molecules with OTMol

When A, B are both a single molecule with n atoms, the inputs to the OTMol algorithm 1 are: X A, X B ∈ Rn×3, coordinates of atoms of A and B; T A, T B, atom labels; BA, BB, adjacency matrices when A, B are seen as graphs. In this work, we consider three types of labels including element name, atom type, and atom connectivity. Distance matrices DA, DB are calculated from X A and BA, X B and BB, respectively. More specifically, if we denote the Euclidean distance matrix by DE and the geodesic distance matrix by DG, then D = (1 − c)DE + cDG, where c ∈ [0, 1] is a weight parameter. The cost matrix is defined by

Cij =

(cid:40)

i = T B T A j , 0, ̸= T B ∞, T A j . i

For a given set of α, denoted by Lα, we solve an fsGW problem with C, DA, DB for each α and choose the atom assignment that has the lowest RMSD. In practice, we often prefer an atom assignment where most bonds are matched. If two bonded atoms in the reference A are not bonded after assignment, we say that this a mismatched bond. We choose the lowest RMSD assignment from the set of atom assignments that have the lowest percentage of mismatched bonds.

Algorithm 1 Alignment of single molecules.

function OTMol(X A, X B, T A, T B, BA, BB, Lα, c)

Calculate C from T A, T B, and DA = (1 − c)DA

E + cDA

G, DB = (1 − c)DB

E + cDB

G from

X A, X B, BA, BB, c for α ∈ Lα do

P ← fsGW(C, DA, DB, α) Calculate P′ if P′ is a permutation then

Run Kabsch algorithm for X A, X B, P′ and get RMSDα

end if

end for Take the lowest RMSDα.

end function

When A, B are complexes of several different molecules, we can modify the atom labels and use algorithm 1 to ensure that the assignment is between the same type of molecules.

When A, B are clusters of individual atoms of the same element, such as noble gas clusters, the cost matrix C is not needed. For a given set of p, denoted by Lp, the OTMol algorithm 2 will first solve a GW problem with inputs DA = (DA E)◦p (Hadamard power) for each p and obtain the aligned coordinates T(X B). The assignment from the GW will be refined by solving a Kantorovich optimal transport (OT) problem

E)◦p, DB = (DB

arg min P∈Γ

⟨P, M⟩F

5

(5)

where Mij = ∥xA

i − T(xB

j )∥2

2. Then we choose the atom assignment that has the lowest RMSD.

Algorithm 2 Alignment of clusters of individual atoms of the same element.

function OTMol(X A, X B, Lp)

for p ∈ Lp do

Calculate DA = (DA P ← GW(DA, DB) Calculate P′ if P′ is a permutation then

E)◦p, DB = (DB

E)◦p from X A, X B

Run Kabsch algorithm for X A, X B, P′ and get T(X B) Calculate M from X A, T(X B) P ← OT(M) Calculate P′ if P′ is a permutation then

Run Kabsch algorithm for X A, X B, P′ and get RMSDp

end if

end if

end for Take the lowest RMSDp.

end function

When A, B are clusters of the same molecule, a proper assignment between them should map a molecule to another molecule, without splitting one. The OTMol algorithm 3 first finds an assignment at the molecule level and then finds an assignment at the atom level. For each molecule, we take a certain coordinate such as the center of mass and obtain an assignment of all representative coordinates using the OTMol algorithm 4. This algorithm searches for representative coordinate assignments by first adding Gaussian noise to the representative coordinates and then solving Kantorovich OT problems, generating a large collection of suboptimal molecule level assignments. This sampling of suboptimal assignments at the molecule level is crucial, as the optimal atom-level assignments may not arise from the optimal molecule-level assignment. Taking a pair of water clusters as an example, suppose that we use centroids as representative coordinates, the orientation of water molecules is ignored when searching for centroid assignments, and an optimal centroid assignment does not necessarily guarantee an optimal assignment of oxygen and hydrogen atoms, especially when the structures are highly symmetric such as 10-PP1 and 10-PP2. The assignment between representative coordinates will be viewed as the assignment between molecules. OTMol then solves an sOT problem with a block cost matrix M, where only the distances between the same element in the matched molecules are finite. This ensures that atoms of a molecule are not assigned to more than one molecule.

In the special case of aligning molecules, the feasible transport plans always fully satisfy the exact marginal distribution constraints in conventional optimal transport settings. Therefore, in practice, the sOT and fsGW problems outlined above can also be solved using existing solvers for the conventional OT [38], GW [31], and fGW (fused Gromov-Wasserstein) problems [35], by replacing the ∞ entries in the cost matrix C with a large constant.

6

Algorithm 3 Alignment of clusters of a certain molecule.

function OTMol(X A, X B, T A, T B, l)

Calculate representative coordinates RA, RB L ← PerturbationBeforeGW(RA, RB, l) for P′ ∈ L do

Run the Kabsch algorithm for RA, RB, P′ and obtain T Calculate M from X A, T(X B), T A, T B, and the assignment of molecules P′ P ← sOT(M) Calulate P′ if P′ is a permutation then

Run Kabsch algorithm for X A, X B, P′ and calculate RMSDP′

end if

end for Take the lowest RMSDP′

end function

Algorithm 4 The function PerturbationBeforeGW.

function PerturbationBeforeGW(X A, X B, l)

Initialize an empty list L for i ∈ {0, 1, . . . , l − 1} do

Add Gaussian noise to X A, X B and get ˜X A, ˜X B E, DB = DB Calculate DA = DA PGW ← GW(DA, DB) Calculate P′ if P′

GW is a permutation then

E from ˜X A, ˜X B

GW

Run Kabsch algorithm for X A, X B, P′ Calculate M from X A, T(X B) P ← OT(M) Calculate P′ if P′ is a permutation then

GW and get T(X B)

Append P′ to L

end if

end if

end for Return L end function

7

2.4 Biomedical Molecular Datasets

To evaluate molecular alignment performance in biologically and pharmaceutically relevant con- texts, we assembled a benchmark that integrates curated biomedical datasets alongside established benchmarks from the ArbAlign study. The curated datasets encompass diverse biomolecular sys- tems, including drug molecules, lipids, nucleic acids, and water clusters, chosen for their biomedical significance and their range of flexibility, stereochemistry, and conformational diversity. The Ar- bAlign datasets contribute noble gas clusters, small peptides, and heterogeneous atmospheric clus- ters, serving as robust baselines for permutation-sensitive alignment tasks. Together, these datasets form a rigorous and multifaceted platform to benchmark alignment algorithms for applications in molecular recognition, drug design, and structural bioinformatics.

ATP dataset This dataset included three types of ATP conformers: (i) a protein-bound ATP con- former extracted from a Protein Data Bank (PDB) structure (PDB ID: 6LN3), (ii) a protein-free ATP conformer coordinated only to metal ions and water molecules from the Cambridge Structural Database (CSD Entry: GAYLOH), and (iii) ATP conformers extracted from protein–ligand com- plexes generated by Boltz-2. ATP was selected as a representative small, flexible biomolecule that adopts distinct conformations in different binding environments, making it suitable for assessing alignment robustness.

(i) a protein-bound Imatinib conformer from the Imatinib dataset This dataset comprised: PDB(PDB ID: 4CSV) , (ii) a protein-free Imatinib conformer from the CSD(CSD Entry: AJIGUZ), and (iii) Imatinib poses extracted from Boltz-2–predicted protein–Imatinib complexes. Imatinib, a tyrosine kinase inhibitor with planar aromatic and heterocyclic rings connected by flexible linkers, presents both rigid and flexible structural features, which can challenge accurate atom mapping during alignment.

Cyclic peptide dataset This dataset contained two subsets of cyclic peptide pairs from the CSD: (i) five pairs with small backbone ϕ–ψ dihedral angle differences (overall average < 15◦; mean: 6.33◦, min: 4.03◦, max: 12.10◦), representing highly similar macrocyclic scaffolds, and (ii) five pairs with large backbone ϕ–ψ dihedral angle differences (overall average > 60◦; mean: 85.58◦, min: 64.32◦, max: 96.26◦), representing more structurally diverse conformations. (iii) The third subset includes a different cyclic peptide pair for each length (4-mer to 8-mer) that exhibits a lower average ϕ–ψ angle difference (mean: 72.40◦, min: 52.35◦, max: 93.45◦) than those in (ii), but a higher RMSD value according to ArbAlign. This dataset was designed to assess alignment accuracy in macrocyclic systems with varying backbone flexibility. We refer to these three subsets as the similar-dihedral set (small ϕ–ψ differences), the dissimilar-dihedral set (large ϕ–ψ differences), and the angle–RMSD discordant set (smller dihedral variation than (ii) but higher global RMSD given by ArbAlign).

Phospholipid (DLP) dataset This dataset focuses on a phospholipid conformer, dilauroylphos- phatidylcholine (DLP), extracted from a protein–ligand complex structure (PDB ID: 1LN1). The conformer was generated by Boltz-2 based on the docked pose within the complex. Phospholipids like DLP contain long aliphatic chains and polar headgroups, presenting challenges in alignment due to their extended and amphipathic nature.

Unsaturated fatty acid (EIC) dataset The EIC dataset includes a single conformer of the unsaturated fatty acid extracted from a protein–ligand complex (PDB ID: 5BVS), generated by Boltz-2. Unsaturated fatty acids like EIC possess flexible hydrocarbon tails with cis double bonds, making them prone to conformational diversity that can affect alignment accuracy.

8

Sugar (BGC and BGC GLC) dataset This dataset contains two sugar conformers: (i) BGC, a mannose-derived monosaccharide, and (ii) BGC GLC, a disaccharide composed of BGC and glucose. Both conformers were extracted from the same protein–ligand complex (PDB ID: 8W4X), with BGC on chain B and BGC GLC on chain C. The conformers were generated using Boltz-2. These molecules highlight the challenge of aligning carbohydrate structures, especially due to their stereochemical complexity and flexibility around glycosidic bonds.

DNA (215D) dataset This dataset includes a single-stranded DNA conformer extracted from the PDB structure 215D. The conformer was generated using AlphaFold3 (AF3) due to limitations in generating correct DNA conformations with Boltz-2 or RDKit. The DNA chain is modeled as a single continuous strand with one predicted 5’ phosphate overhang. This case represents nucleic acid alignment, where backbone continuity and phosphate positioning can affect the comparison.

Water cluster datasets We evaluate alignment performance on three water cluster datasets. The first dataset is taken directly from the ArbAlign paper and consists of selected water cluster conformer pairs used in their benchmark evaluations. The second and third datasets are curated in this work using structures from the Database of Water Cluster Minima [39], which provides optimized geometries for water clusters ranging in size from n = 3 to 30. In the second dataset, for each cluster size n, we select a pair of conformers with the lowest and second-lowest energies among the reported minima. This set represents energy-proximal conformations and is used to assess alignment accuracy in subtle structural variations. In the third dataset, for each cluster size n, we identify the conformer pair with the largest RMSD among the up to 20 lowest-energy struc- tures. This set emphasizes geometric diversity while maintaining energetic plausibility, providing a more challenging test for alignment algorithms. Together, these datasets support a comprehensive evaluation of alignment robustness across both energetically and geometrically diverse water cluster structures.

2.5 Evaluation Metrics

2.5.1 Bond Connectivity Inconsistency (BCI) Check

To evaluate the topological fidelity of structural alignments, we implemented a Bond Connectivity Inconsistency (BCI) metric. This measure quantifies the percentage of covalent bonds in the refer- ence structure that are not preserved in the aligned structure, thereby capturing gross mismatches in atom–atom connectivity. Specifically, all covalent bonds (including both single and double bonds) in the reference molecule are extracted as unordered atom pairs (tuples), ignoring bond order and chemical environment. A bond is considered preserved if the same atom pair is found in the aligned structure. Conversely, if a reference bond is not recovered after alignment, it contributes to the BCI score. Thus, the BCI reflects alignment-induced topological disruption, independent of bond type, valence, or atomic hybridization. A BCI of 0% indicates a perfect alignment in which all reference bonds are retained, while higher values correspond to increasing levels of connectivity inconsistency. This topological validation serves as a structural prerequisite for chemically plausible alignments and is particularly useful for detecting severe misalignments that disrupt molecular backbone or ring structures. Note that BCI is a structural metric and does not assess the chemical correctness of the aligned conformation. It is used as a requirement-level consistency check prior to further chemical or energetic evaluation. The user can let OTMol algorithm 1 choose the lowest RMSD assignment from the set of lowest BCI assignments.

9

Table 1: Summary of Datasets Used for Molecular Alignment Evaluation

Source

Description

Dataset

ATP

Imatinib

Molecular Type Nucleotide

Small molecule drug

Curated this work

Curated this work

in

in

Cyclic pep- tides

Macrocycles

Curated this work

in

Phospholipid (DLP)

Lipid

Lipid

Unsaturated acid fatty (EIC) Sugar (BGC, BGC GLC)

DNA (215D) Nucleic acid

Curated this work

Curated this work

in

in

this work

Curated this work

in

Carbohydrates Curated

in

clus-

ArbAlign pa- per

Protein-bound, metal-coordinated, and Boltz-2- generated ATP conformers. Tests robustness across conformational diversity. Protein-bound, unbound(CSD Entry: AJIGUZ), and Boltz-2-generated conformers of a flexible kinase inhibitor. Challenges atom mapping due to mixed rigidity/flexibility. Three subsets of five pairs from CSD: one with small (<15◦) and one with large (>60◦) ϕ–ψ differences, and a third with discordant dihedral–RMSD behav- ior, where global backbone divergence (RMSD) is high despite moderate local angle differences. Eval- uates alignment sensitivity to macrocyclic flexibility. DLP conformer from protein-ligand complex (PDB 1LN1), generated by Boltz-2. Amphipathic with long aliphatic chains. Flexible hydrocarbon chain with cis double bonds from PDB 5BVS. Boltz-2-generated.

Monosaccharide and disaccharide from PDB 8W4X, Boltz-2-generated. Tests stereochemical and glyco- sidic bond alignment. Single-stranded DNA conformer generated by Al- phaFold3. Assesses backbone continuity and phos- phate positioning. The reference structure is col- lected from PDB database(PDB ID: 215D). Benchmark pairs of water cluster conformers used in the original ArbAlign study.

clus-

Curated this work

clus-

Curated this work

in

in

From [39]; pairs with lowest and second-lowest en- ergy for n = 3 to 30. Tests subtle structural varia- tions. From [39]; pairs with largest ArbAlign RMSD among lowest 20 energy structures. Evaluates geometric di- versity.

Water ters

Water ters

Water ters

clus- (Ar-

Water ter bAlign) Water clus- ters (minima pairs) Water ters RMSD pairs) FGG Tripep- tide

clus- (max

Peptides

ArbAlign pa- per

S1-MA-W1 cluster

Atmospheric hydrate

ArbAlign pa- per

Neon ters

clus-

Noble clusters

gas

ArbAlign pa- per

15 FGG conformers (one global minimum + 14 higher-energy). Contains a stereocenter to evaluate chirality-sensitive alignment. Cluster with bisulfate, methylammonium, and water. Requires precise atom-type and hybridization-aware mapping. Neon clusters of sizes n =10 to 1000. Permutation- ally symmetric, tests optimal atom reordering under dispersion interactions.

10

2.5.2 Atom Mapping Inconsistency (AMI) Check

In addition to the bond-level Bond Connectivity Inconsistency (BCI), we introduce an atom-level metric termed Atom Mapping Inconsistency (AMI) to assess the chemical fidelity of the alignment between reference and predicted structures for cases. AMI quantifies the proportion of atoms whose mapped counterparts fall into chemically inconsistent environments, based on a Maximum Common Substructure (MCS) framework. Specifically, we perform an MCS search using RDKit to identify the largest shared substructure between the reference and aligned molecules. Atom-to- atom correspondences are then extracted from the MCS match. To assess whether aligned atoms are chemically equivalent, we compute canonical atom ranks for both molecules. These ranks group atoms into equivalence classes based on local chemical environment and molecular symmetry, while ignoring stereochemistry and isotopes. For each matched atom pair, we verify whether the aligned atom belongs to the same symmetry group as the reference atom. Any atom whose mapped counterpart falls outside its expected group is counted as inconsistent. The AMI score is reported as the percentage of mismatched atoms among all atoms in the MCS. An AMI of 0% indicates a chemically coherent atom mapping, whereas higher values reflect increasing degrees of chemically implausible alignment at the atomic level. Unlike BCI, which captures gross topological mismatches, AMI detects more subtle alignment errors involving local environment discrepancies, making it a complementary and chemically sensitive evaluation criterion for some cases requiring more details.

3 Results

To systematically assess the performance of OTMol in biologically and chemically relevant scenarios, we performed alignment experiments across a suite of curated biomedical molecular datasets. These benchmarks span diverse molecular classes, including peptides, nucleic acids, drug-like compounds, and biomolecular clusters, as well as previously established ArbAlign datasets, ensuring coverage of both biologically significant systems and permutation-sensitive test cases(see Method section). This comprehensive evaluation framework enables us to probe the robustness, chemical fidelity, and computational efficiency of OTMol in contexts relevant to structural biology, medicinal chemistry, and molecular informatics. For most datasets, we only used element names as atom labels, with the exception of the FGG and atmospheric hydrates datasets. The OTMol alignments were computed by solving the fsGW and sOT problems using the fGW and Earth Mover’s Distance (EMD) solvers from the Python Optimal Transport (POT) library [40, 41].

3.1 Performance on Biomedical Molecular Dataset

3.1.1 Overall Description

We used the OTMol algorithm 1 to align eight biomolecules with their conformers. In the exper- iment, we let Lα = {0, 0.01, 0.02, . . . , 0.99, 1} and c = 1, meaning that only geodesic distance is used. We only choose the assignment with the lowest RMSD from the set of assignments that have the lowest BCI values. In other words, we hope that the atom assignment is very close to a graph isomorphism. OTMol is able to match all edges for all pairs of conformers. Although ArbAlign gives lower RMSD values, its atom assignments usually involve inconsistent bond connectivity and atom-mismatching issues. The bond connection condition in the aligned molecules is evaluated with Bond Connectivity Inconsistency (BCI) and the atom mapping condition within chemical en-

11

vironment is evaluated with Atom Mapping Inconsistency (AMI), see method Evaluation Metrics subsection for more details.

3.1.2 Application to Adenosine Triphosphate

Adenosine triphosphate (ATP) is essential for numerous cellular processes, serving both as an energy source and a phosphate donor. Due to its structural flexibility, ATP can adopt diverse conformations under different conditions, making structural comparisons both meaningful and challenging [42, 43]. Two ATP conformers from different structural databases were selected for evaluation. The conformer from the Protein Data Bank (PDB ID: 6LN3; Figure 1A, Left) is bound within a receptor pocket, whereas the conformer from the Cambridge Structural Database (CSD Entry: GAYLOH; Figure 1A, Right) is coordinated only to metal ions and water molecules. In addition, protein–ligand complexes generated by Boltz-2 were used to extract ATP conformers for comparison. Structural files from different sources often differ in atom ordering, naming conventions, geometries, and other formatting aspects, providing effective test cases for assessing alignment capabilities and evaluating result plausibility.

Applying ArbAlign to align ATP conformers from different sources revealed two main issues: (1) frequent atom mismatches in the aligned structures used for RMSD calculation, and (2) changes in stereochemistry when a reflection operation was applied. Accurate atom mapping is essential for meaningful RMSD calculation and interpretation. In one ArbAlign alignment, 9 oxygen atoms and 2 carbon atoms were mismatched, corresponding to an AMI mismatch rate of 35.48% which is unexpectedly high for ATP (Figure 1B), a well-characterized and relatively simple molecule with 31 heavy atoms. Moreover, in some cases, the entire molecular chirality was inverted due to reflection. Since ArbAlign applies reflection operations by default, this can yield mirrored molecules that minimize RMSD but distort stereochemistry. For example, aligning a Boltz-generated ATP pose to the reference structure resulted in a mirrored conformation with three reversed chiral centers (Figure 1C).

3.1.3 Application to Tyrosine Kinase Inhibitor: Imatinib

Imatinib mesylate (marketed as Gleevec® or Glivec® by Novartis, Switzerland) represents a land- mark in rational drug design, as it specifically targets a single molecular event that is both necessary and sufficient to initiate carcinogenesis [44, 45].

We performed structural comparison analyses of different Imatinib conformers, including free forms and those bound to either wild-type or mutant platelet-derived growth factor receptors (PDGF- R). Such conformational differences can provide insights into potential binding modes and possible mechanisms of drug resistance in mutant receptors. Similar to the ATP case (Figure 1), two structures were selected from the Protein Data Bank (protein-bound pose) and the Cambridge Structural Database (protein-free pose) (Figure 2A). In addition, protein–Imatinib complexes were predicted by Boltz-2, and the extracted Imatinib poses were analyzed.

Imatinib contains planar aromatic and heterocyclic rings, along with flexible linkers and multiple rotatable bonds, making it a particularly challenging case for alignment. The AMI mismatch per- centage reached 81.08%, with most ring atoms failing to map to the correct or equivalent positions. Although the ArbAlign-generated alignment yielded an RMSD of 3.33 ˚A, which is lower than that from OTMol, this suggests that ArbAlign may minimize the overall RMSD at the expense of correct

12

Figure 1: (A) Visualization of the ATP molecules from PDB and CSD databases. Only the ATP part is shown. (Left: ATP molecule in PDB database, PDB ID: 6LN3; Right: ATP molecule in CSD database, CSD Entry: GAYLOH). (B) The atom mismatching analysis of the ATP molecule (collected from the CSD database) aligned by ArbAlign and OTMol, respectively. The mismatched heavy atoms are colored in red. (C) The diagram of the ATP molecule (generated by Boltz-2; model-0) before and after alignment via ArbAlign in both 3-dimensional and 2-dimensional diagrams. (Lower: original ATP molecule configuration before alignment via ArbAlign; Upper: ATP molecule configuration after alignment via ArbAlign.)

13

atom mapping (Figure 2B).

(A) Visualization of the Imatinib molecules from PDB and CSD databases. Only the ATP part is Figure 2: shown. (Left: ATP molecule in PDB database, PDB ID: 4CSV; Right: ATP molecule in CSD database, CSD Entry: AJIGUZ). (B) The atom mismatching analysis of Imatinib molecule (collected from CSD database) aligned by ArbAlign and OTMol, respectively. The mismatched heavy atoms are colored in red.

3.1.4 Application to Cyclic Peptide Backbones

To evaluate structural similarity and conformational accuracy in cyclic peptides, backbone RMSD is a key metric for assessing how well predicted or designed peptide backbones match known, expected, or reference structures. This is particularly important for benchmarking alignment algorithms in applications such as cyclic peptide design and discovery. In this context, the minimal RMSD value serves as an appropriate indicator of overall cyclic peptide scaffold similarity and can provide useful insights for cyclic peptide design. In our evaluation dataset, we selected three groups of cyclic peptide pairs from the CSD database: five pairs with small backbone ϕ and ψ dihedral angle differences (overall average ϕ–ψ difference < 15◦) and five pairs with large backbone ϕ and ψ dihedral angle differences (overall average ϕ–ψ difference > 60◦), and five angle–RMSD discordant pairs, where the overall average ϕ–ψ difference is lower than that of the second set but the RMSD values given by ArbAlign are larger. Further details are provided in the Biomedical Molecular Datasets subsection of Materials and Methods Section.

The OTMol algorithm 1 was applied to three small datasets of cyclic peptide backbones. For each pair, Lα = {0, 0.01, 0.02, . . . , 0.99, 1}, and c = 0.5. We only choose the assignment with the lowest RMSD from the set of assignments that have the lowest BCI values. In theory, a pair of cyclic peptides with similar dihedral angles should have similar structures, so the true RMSD should be very low. OTMol yields very low RMSD (less than 0.5˚A) for all pairs with the dataset of similar dihedral angles (Figure 3). The bonds are all recalled in OTMol-aligned structures, i.e., mismatched bond percentage is 0%, and these results show lower RMSD, indicating the more accurate atom mapping and alignment results.

14

Figure 3: (A, B, C, D, E) The OTMol alignment of the 4-mer pair, 5-mer pair, 6-mer pair, 7-mer pair, and 8-mer pair in the dataset of similar dihedral angle dataset, respectively. (F) The RMSD comparison for the three cyclic peptides datasets.

3.1.5 Other Results in Biomedical Molecules

We also collect and compare other important biological molecules, such as DNA, lipids and sugars, as decribed in the Methods section. These results are consistent with the previous results in ATP and Imatinib. The Bond Connection Inconsistency rate is 0% in our OTMol aligned results while the mean Bond Connection Inconsistency rate of 24.5 ± 15.03% in those ArbAlign results (See Table 2). The RMSD value is only meaningful under the condition that the mismatched bond percentage is close to 0.

Table 2: Summary statistics of %Bond Connectivity Inconsistency for generated molecules aligned by ArbAlign in the Biomedical Molecular Dataset. All values are shown as percentages.

PDB ID Molecule Mean

Std Min Max

Q1 Median

Q3

6ln3 5bvs 8w4x 4csv 215d 8w4x 1ln1

28.46% 3.84% 15.15% 39.39% 27.27% ATP 24.74% 15.67% 0.00% 52.63% 15.79% EIC 16.80% 20.55% 0.00% 70.00% 0.00% BGC 21.23% 16.20% 0.00% 63.41% 8.54% Imatinib DNA 0.00% 0.00% 0.00% 0.00% 0.00% BGCGLC 30.20% 17.41% 0.00% 65.00% 20.00% 49.74% 11.64% 28.30% 79.25% 41.51% DLP

30.30% 30.30% 18.42% 36.84% 0.00% 30.00% 21.95% 30.49% 0.00% 0.00% 30.00% 40.00% 50.94% 59.91%

15

3.2 Performance on ArbAlign Dataset

In this section, we evaluate OTMol on the benchmarking datasets from ArbAlign.

3.2.1 Application to Small Peptides FGG and Atmospheric Hydrates

The FGG dataset consists of tripeptides composed of one phenylalanine (F) and two glycines (G), where phenylalanine contributes an aromatic side chain and a chiral center. We calculated the RMSD between the global minimum structure (FGG 55) and 14 higher-energy conformations. The presence of a stereocenter in phenylalanine allows us to assess chirality preservation in the alignment process. Similarly, the S1-MA-W1 dataset consists of a pair of configurations of an atmospheric cluster containing one bisulfate ion, one methylammonium ion, and one water molecule. For the S1-MA-W1 dataset, we performed alignment between the reference structure s1-ma-w1-1 and other molecules. In contrast to symmetric water or noble gas clusters, where all atoms of the same element have uniform hybridization and connectivity, the atoms in S1-MA-W1 differ significantly in bonding environments. For instance, oxygen atoms exist in both sp2 and sp3 hybridizations. Assignments based only on atom names can lead to incorrect mappings, such as aligning chemically distinct oxygen atoms. Therefore, accurate alignment in this dataset requires incorporating finer atomic labels, such as SYBYL Mol2 types and atom connectivity.

Both the tripeptide FGG dataset and the atmospheric hydrates dataset have been previously eval- uated using ArbAlign, making them well-suited for comparative benchmarking of alignment perfor- mance. In the experiment, we let Lα = {0, 0.01, 0.02, . . . , 0.99, 1} for two datasets. We let c = 0.5 for the FGG dataset and c = 1 for the S1-MA-W1 dataset. We only choose the assignment with the lowest RMSD from the set of assignments that have the lowest BCI values. The influence of individual α when c = 0.5 on OTMol RMSD for the pair FGG 55, FGG 470 is shown in Figure 4B.

3.2.2 Application to Neon Clusters

Noble gas clusters are held together by weak dispersion forces, enabling them to adopt a vast number of energetically accessible configurations. Rigorous comparison of such clusters requires careful reordering of atoms, as permutations can yield more accurate alignments and lower RMSD values. We employed our OTMol algorithm 2 on the Neon cluster dataset from the ArbAlign paper. The dataset consists of Neon clusters with sizes n = 10, 50, 100, 150, 200, 300, 500, and 1000. In the experiment, we let Lp = {0.5, 1, 1.5, 2, 2.5, 3, 3.5, 4, 4.5}. The OTMol alignment of each pair is shown in Figure 4E. OTMol can align all pairs very closely except for the pair with 200 atoms. The influence of p on the OTMol alignment of 150-1 and 150-2 is shown in Figure 4F-H. OTMol RMSD value doesn’t decrease when p increases.

3.2.3 Application to Water Clusters

Water clusters play a critical role in both condensed matter systems [46] and biological environments [47]. Due to the interchangeability of water molecules within these clusters, it is often necessary to permute monomers, or their constituent oxygen and hydrogen atoms, to achieve optimal alignment prior to RMSD calculation. We compared the results of the OTMol algorithm 3 and ArbAlign on three water cluster datasets. The first dataset is taken from the ArbAlign paper. The second and third datasets contain water clusters selected from the Database of Water Cluster Minima [39] that

16

Figure 4: (A) The OTMol alignment of FGG 55 (reference structure; colored in red) and FGG 470 (structure to be aligned; colored in blue) when c = 0 (left) or 0.5 (right), respectively. Element names are used as labels. (B) The influence of α on OTMol RMSD of the pair FGG 55 (colored in red), FGG 470 (colored in blue) when c = 0.5. (C) The OTMol alignment of FGG 55 (colored in red) and FGG 470 (colored in blue) when α = 0.01, c = 0.5. RMSD = 3.45˚A. BCI = 92%. (D) The OTMol alignment of FGG 55 and FGG 470 when α = 0.62, c = 0.5. RMSD = 2.45˚A. BCI = 3%. (E) The OTMol alignment of all pairs in the Neon cluster dataset. (F) The influence of p on OTMol RMSD of 150-1, 150-2. (G) The OTMol alignment of 150-1, 150-2 when p = 2. RMSD = 0.53˚A. (H) The OTMol alignment of 150-1, 150-2 when p = 3. RMSD = 0.19˚A.

17

Figure 5: (A) The influence of l on OTMol RMSD of the pair 10-PP1 and 10-PP2. The OTMol RMSD decreases as the number of perturbations increases. (B) The OTMol alignment of 10-PP1(pink: hydrogen atoms; red: oxygen atoms), 10-PP2(light blue: hydrogen atoms; dark blue: oxygen atoms) when l = 2. RMSD = 1.47˚A. (C) The OTMol alignment of 10-PP1(pink: hydrogen atoms; red: oxygen atoms) , 10-PP2(light blue: hydrogen atoms; dark blue: oxygen atoms) when l = 21. RMSD = 0.64˚A. (D) The boxplots of the difference OTMol RMSD - ArbAlign RMSD for all datasets. WC0: the water cluster dataset from the ArbAlign paper; WC1: pairs of water clusters that have the lowest and second-lowest energies for each group of size n; WC2: pairs of water clusters that have the largest ArbAlign RMSD for each group of size n; NC: Neon clusters; FGG: tripeptides FGG (0, 1, and 2 represent three settings of atom labels: element name, SYBYL type, and atom connectivity, respectively); S1MAW1: atmospheric hydrates (0, 1, and 2 represent three settings of atom labels: element name, SYBYL type, and atom connectivity, respectively). (E) The boxplots of the difference OTMol RMSD - ArbAlign EMD RMSD for all datasets. The results of ArbAlign EMD are almost identical to those of ArbAlign.

18

contains water clusters of sizes n = 3 − 30. The second dataset consists of pairs of water clusters that have the lowest and second-lowest energies for each group of size n. The third dataset consists of pairs of water clusters that have the largest ArbAlign RMSD for each group of size n. We choose the centroid of each molecule as its representative coordinate. The number of perturbations l on the centroid coordinates is 100 for all pairs. The influence of l on OTMol RMSD of the pair 10-PP1 and 10-PP2 is shown in Figure 5A-C.

3.2.4 Comparison with ArbAlign Results

We presents a boxplot analysis of the difference between OTMol RMSD and ArbAlign RMSD across all datasets (Figure 5D). The results demonstrate that OTMol achieves lower RMSD values than ArbAlign for the majority of molecule pairs. We also compared OTMol with another method ArbAlign EMD (Figure 5E). ArbAlign EMD is identical to ArbAlign except that the Hungarian algorithm solver is substituted by the EMD solver in the Python Optimal Transport (POT) library. The RMSD values produced by OTMol on the FGG and S1-MA-W1 datasets are relatively higher than those from ArbAlign. This discrepancy is likely due to the fact that ArbAlign allows reflection, which can alter molecular chirality, whereas OTMol preserves stereochemistry by design. Therefore, RMSD alone should not be the sole criterion for evaluating alignment quality; it is equally important to consider whether the chemical integrity, such as chirality and bonding, is maintained in the aligned structures (see Figure 6, 7).

One limitation of ArbAlign is that it does not guarantee that atoms of a water molecule are assigned to only one water molecule. The number of mismatched water molecules in ArbAlign alignment increases as the number of water molecules in the clusters increases (Figure 8). When ArbAlign yields lower RMSD values than OTMol, there are usually mismatched water molecules.

3.3 Time Advantage

Running time comparisons between OTMol and ArbAlign shown in Figure 9 were performed on a MacBook Pro equipped with an Apple M1 Pro chip to ensure consistent benchmarking conditions. All three OTMol algorithms 1, 2, and 3 have a theoretical time scaling of O(n3). OTMol is much faster than ArbAlign for large systems. Both OTMol and ArbAlign show increasing computational cost with system size; however, OTMol demonstrates significantly better scalability. While Ar- bAlign’s runtime grows steeply beyond 100 atoms, OTMol maintains noticeably lower execution times, particularly for clusters with 200 or more atoms.

19

Figure 6: Comparison of OTMol and ArbAlign alignments on the FGG tripeptides. (A) RMSD comparison. A black cross indicates an ArbAlign alignment that involves reflection. We also modified ArbAlign so that reflection is not allowed and calculated results. (B) Visualization of the short peptides FGG55 and FGG99 conformation and their chiral configuration at the phenylalanine(F). (C) Visualization of the short peptides FGG55 and FGG99 conformation aligned via ArbAlign and their chiral configuration at the phenylalanine(F). (D) Visualization of the short peptides FGG55 and FGG99 conformation aligned via OTMol and their chiral configuration at the phenylalanine(F).

20

Figure 7: Comparison of alignment results for atmospheric hydrate configurations. (A) RMSD comparison. A black cross indicates an ArbAlign alignment that involves reflection. We also modified ArbAlign so that reflection is not allowed and calculated results. (B) A Visualization of the system configuration (bisulfate ion-methylammonium ion- water molecule) of system-1 (s1maw1-1) and system-2 (s1maw1-2). (C) Anaylisis of the system configuration (bisulfate ion-methylammonium ion-water molecule) of system-1 (s1maw1-1) and system-2 (s1maw1-2) after alignment via ArbAlign. The atom mapping in the reference system (system-1) and the aligned system (system-2) are shown with atom labels and black arrows. The corresponding bonds missing in the system-2 are highlighted in the system- 1 in orange color. (D) Anaylisis of the system configuration (bisulfate ion-methylammonium ion-water molecule) of system-1 (s1maw1-1) and system-2 (s1maw1-2) after alignment via OTMol. The atom mapping in the reference system (system-1) and the aligned system (system-2) are shown with atom labels and black arrows. The corresponding bonds missing in the system-2 are highlighted in the system-1 in orange color. No highlighted bond in orange color means there are no mismatched bonds.

Figure 8: (A) The RMSD values of ArbAlign and OTMol for water cluster datasets. Two representative options, centroid and oxygen atoms, are used. The x axis represents the number of water molecules in clusters. The number above the red dots are the number of mismatched water molecules in ArbAlign alignments. (B, C) Comparison of water cluster alignments between 10-PP1 (pink: hydrogen atoms; red: oxygen atoms) and 10-PP2 (light blue: hydrogen atoms; dark blue: oxygen atoms) using OTMol and ArbAlign. (B) is the OTMol alignment and (C) is the ArbAlign alignment. Notably, the ArbAlign alignment exhibits five mismatched water molecules.

21

Figure 9: (A, B) The running time comparison of OTMol and ArbAlign for the Neon cluster dataset and the water cluster dataset from the ArbAlign paper.

4 Discussion and Conclusions

4.1 Accurate Atom Mapping and Chirality with OTMol

Usually, for RMSD calculation algorithms performance comparison, a lower RMSD will be consid- ered as a more accurate RMSD calculation, because the wrong alignment (translate, rotate, swap, etc.) will probably lead to a larger RMSD. However, if the atom mapping algorithm ignores the bonds or chemical environment, such as ArbAlign, the final alignment with wrong mapping will lead to a much lower RMSD than theoretically minimal RMSD value, as mentioned in the Results section, in the case of ATP and Imatinib (Figure 1, 2). In addition, although ArbAlign does not allow reflection when using the Kabsch algorithm, some initial transformations involve reflections and will change the chirality as mentioned in ATP and peptide FGG alignment cases in the results section (Figure 1, 6). The molecule with different (R) and (S) chiral properties can be totally regarded as a different molecule. Also, for water clusters, sometimes the oxygen and two hydrogen atoms of a certain water molecules are mapped to other water molecules respectively (Figure 8).

Only under the condition that the molecule’s chemical information is ensured, a lower RMSD value will suggest a better alignment for a certain RMSD algorithm. Thus, when evaluating these cases, we explore the atom matching situation or bond connection status, in addition to the RMSD value comparison. This comprehensive comparison will be helpful to a better understanding of the alignment-based RMSD calculation. The incorporation of bonding information and graph geodesic distance is the main reason why OTMol gives a more correct atom assignment. OTMol also keeps chirality since reflection is not allowed in the use of the Kabsch algorithm.

4.2 Computational Efficiency with OTMol

Figure 9 compares the runtime of OTMol algorithms 2 and 3, which scale as O(n3). OTMol has an obvious advantage over ArbAlign in computational efficiency for larger molecules or clusters. The running time of OTMol can be controlled by tuning various hyperparameters. In contrast, ArbAlign uses 48 initial spatial transformations, and some transformations are redundant. With the increasing interest and research of macromolecules such as peptides, DNAs, and polysaccharides, and the awareness of the importance of water clusters in biological systems, a more efficient RMSD calculation algorithm will be preferred.

22

4.3 The Fused Supervised Gromov-Wasserstein problem

The development of OTMol represents a significant advancement in molecular alignment through the application of optimal transport theory. OTMol formulates the molecular alignment problem as a special case (4) of the general fused supervised Gromov-Wasserstein (fsGW) problem, which is a bilevel optimization

max s∈[0,min{∥a∥1,∥b∥1}]

min P∈Us(≤a,≤b)

(1 − α)⟨C, P⟩F + α

M(DA, DB)ijklPijPkl

(6)

(cid:88)

i,j,k,l

ik − DB

where a, b are two histograms, Us(≤ a, ≤ b) = {P ∈ Rn×m + |P1 ≤ a, PT 1 ≤ b, ⟨P, 1⟩F = s}, ik − DB ik − DB C is a cost matrix that has infinite entries, Mijkl = (DA jl| ≤ ρ, = ∞ if |DA jl| > ρ. In addition to the molecular alignment problem, the fsGW framework can also be applied to other alignment problems in chemistry. For example, the comparison of structurally similar molecules is an important problem in chemistry, especially in drug discovery. When two similar molecules have a common substructure, we can view the problem of finding the maximum common substructure as a general fsGW problem whose goal is to transport the maximal number of atoms from one molecule to another. Looking forward, the application of optimal transport theory to other molecular alignment problems is highly promising.

jl)2 if |DA

Data and Code Availability

Code and data are available at https://github.com/weixiaoqimath/otmol.

5 Acknowledgements

This work is partly supported by National Science Foundation grants DMS2151934 (Z.C.) and DMS2142500 (Y. Zhao) and U.S National Institutes of Health grants R01GM152494 (Z.C.) and R35-GM127040 (Y. Zhang). We thank NC State High Performance Computing Services Core Fa- cility, NYU-ITS and the Simons Center for providing computational resources. X.D. acknowledges partial support from a graduate fellowship from the Simons Center for Computational Physical Chemistry (SCCPC) at NYU.

References

[1] Mark A. Johnson, Gerald M. Maggiora, et al. Concepts and applications of molecular similarity.

Wiley, 1990.

[2] Yuki Yamamoto. Algorithm for efficient superposition and clustering of molecular assem- blies using the branch-and-bound method. Journal of Chemical Information and Modeling, 65(9):4512–4530, April 2025.

[3] John Jumper and et al. Accurate structure prediction of biomolecular interactions with Al-

phaFold3. Nature, 630:493–500, 2025.

23

[4] Zhuoran Qiao, Weili Nie, Arash Vahdat, Thomas F. Miller III, and Animashree Anandkumar. State-specific protein–ligand complex structure prediction with a multiscale deep generative model. Nature Machine Intelligence, 6:195–208, 2024.

[5] Jeremy Wohlwend, Gabriele Corso, Saro Passaro, Regina Barzilay, and Tommi Jaakkola. Boltz-1: Democratizing biomolecular interaction modeling with open-source foundation mod- els. bioRxiv, 2024. Preprint.

[6] Jeremy Wohlwend, Gabriele Corso, Saro Passaro, Regina Barzilay, and Tommi Jaakkola. Boltz-2: A biomolecular foundation model for structure and binding affinity prediction, 2025. PDF available at https://jeremywohlwend.com/assets/boltz2.pdf.

[7] Enming Xing, Junjie Zhang, Shen Wang, and Xiaolin Cheng. State-aware protein–ligand complex prediction using AlphaFold3 with purified sequences. arXiv, 2025. arXiv:2506.00147.

[8] Jianing Lu, Cheng Wang, and Yingkai Zhang. Predicting molecular energy using force-field optimized geometries and atomic vector representations learned from an improved deep tensor neural network. Journal of Chemical Theory and Computation, 15(7):4113–4121, May 2019.

[9] Jianing Lu, Song Xia, Jieyu Lu, and Yingkai Zhang. Dataset Construction to Explore Chemical Space with 3D Geometry and Deep Learning. Journal of Chemical Information and Modeling, 61(3):1095–1104, March 2021.

[10] R. M. Shields, B. Temelso, K. A. Archer, T. E. Morrell, and G. C. Shields. Accurate predictions of water cluster formation, (h2o)n = 2–10. J. Phys. Chem. A, 114(43):11725–11737, 2010.

[11] B. Temelso, K. A. Archer, and G. C. Shields. Benchmark structures and binding energies of small water clusters with anharmonicity corrections. J. Phys. Chem. A, 115(43):12034–12046, 2011.

[12] D. J. Wales and J. P. K. Doye. Global optimization by basin-hopping and the lowest energy structures of Lennard–Jones clusters containing up to 110 atoms. J. Phys. Chem. A, 101:5111– 5116, 1997.

[13] D. J. Wales, J. P. K. Doye, A. Dullweber, M. P. Hodges, F. Y. Naumkin, F. Calvo, http:

J. Hern´andez-Rojas, and T. F. Middleton. The Cambridge Cluster Database. //www-wales.ch.cam.ac.uk/CCD.html. Accessed March 1, 2015.

[14] Y. Xiang, W. Cai, H. Jiang, and X. Shao. An efficient method based on lattice construction and the genetic algorithm for optimization of large Lennard–Jones clusters. J. Phys. Chem. A, 108(16):3586–3592, 2004.

[15] Y. Xiang, L. Cheng, W. Cai, and X. Shao. Structural distribution of Lennard–Jones clusters

containing 562 to 1000 atoms. J. Phys. Chem. A, 108:9516–9520, 2004.

[16] Berhane Temelso, Joel M Mabey, Toshiro Kubota, Nana Appiah-Padi, and George C Shields. ArbAlign: a tool for optimal alignment of arbitrarily ordered isomers using the Kuhn–Munkres algorithm. Journal of chemical information and modeling, 57(5):1045–1054, 2017.

[17] Wolfgang Kabsch. A solution for the best rotation to relate two sets of vectors. Foundations

of Crystallography, 32(5):922–923, 1976.

24

[18] Evangelos A Coutsias, Chaok Seok, and Ken A Dill. Using quaternions to calculate RMSD.

Journal of computational chemistry, 25(15):1849–1857, 2004.

[19] William J Allen and Robert C Rizzo. Implementation of the Hungarian algorithm to account for ligand symmetry and similarity in structure-based design. Journal of chemical information and modeling, 54(2):518–529, 2014.

[20] Benjamin Helmich and Marek Sierka. Similarity recognition of molecular structures by op- timal atomic matching and rotational superposition. Journal of Computational Chemistry, 33(2):134–140, 2012.

[21] Jorge MC Marques, JL Llanio-Trujillo, PE Abreu, and Francisco Baptista Pereira. How differ- ent are two chemical structures? Journal of Chemical information and Modeling, 50(12):2129– 2140, 2010.

[22] Nicola J Richmond, Peter Willett, and Robert D Clark. Alignment of three-dimensional molecules using an image recognition algorithm. Journal of Molecular Graphics and Modelling, 23(2):199–209, 2004.

[23] Ali Sadeghi, S Alireza Ghasemi, Bastian Schaefer, Stephan Mohr, Markus A Lill, and Stefan Goedecker. Metrics for measuring distances in configuration spaces. The Journal of chemical physics, 139(18), 2013.

[24] Jos´e Manuel V´asquez-P´erez, Gabriel Ulises Gamboa Mart´ınez, Andreas M K¨oster, and Patrizia Calaminici. The discovery of unexpected isomers in sodium heptamers by Born–Oppenheimer molecular dynamics. The Journal of chemical physics, 131(12), 2009.

[25] Arne Wagner and Hans-J¨org Himmel. aRMSD: a comprehensive tool for structural analysis.

Journal of Chemical Information and Modeling, 57(3):428–438, 2017.

[26] Rainer E Burkard and Eranda Cela. Linear assignment problems and extensions. In Handbook

of combinatorial optimization: Supplement volume A, pages 75–149. Springer, 1999.

[27] Harold W Kuhn. The Hungarian method for the assignment problem. Naval research logistics

quarterly, 2(1-2):83–97, 1955.

[28] James Munkres. Algorithms for the assignment and transportation problems. Journal of the

society for industrial and applied mathematics, 5(1):32–38, 1957.

[29] Roy Jonker and Ton Volgenant. A shortest augmenting path algorithm for dense and sparse linear assignment problems. In DGOR/NSOR: Papers of the 16th Annual Meeting of DGOR in Cooperation with NSOR/Vortr¨age der 16. Jahrestagung der DGOR zusammen mit der NSOR, pages 622–622. Springer, 1988.

[30] Facundo M´emoli. Gromov–Wasserstein distances and the metric approach to object matching.

Foundations of computational mathematics, 11:417–487, 2011.

[31] Gabriel Peyr´e, Marco Cuturi, and Justin Solomon. Gromov-wasserstein averaging of kernel In International conference on machine learning, pages 2664–2672.

and distance matrices. PMLR, 2016.

[32] Zixuan Cang, Qing Nie, and Yanxiang Zhao. Supervised optimal transport. SIAM Journal on

Applied Mathematics, 82(5):1851–1877, 2022.

25

[33] Zixuan Cang, Yaqi Wu, and Yanxiang Zhao. Supervised Gromov–Wasserstein Optimal Trans- port with Metric-Preserving Constraints. SIAM Journal on Mathematics of Data Science, 7(1):301–328, 2025.

[34] Gabriel Peyr´e, Marco Cuturi, et al. Computational optimal transport: With applications to

data science. Foundations and Trends® in Machine Learning, 11(5-6):355–607, 2019.

[35] Vayer Titouan, Nicolas Courty, Romain Tavenard, and R´emi Flamary. Optimal transport for structured data with application on graphs. In International Conference on Machine Learning, pages 6275–6284. PMLR, 2019.

[36] Jim Lawrence, Javier Bernal, and Christoph Witzgall. A purely algebraic justification of the Kabsch-Umeyama algorithm. Journal of research of the National Institute of Standards and Technology, 124:1, 2019.

[37] Shinji Umeyama. Least-squares estimation of transformation parameters between two point patterns. IEEE Transactions on Pattern Analysis & Machine Intelligence, 13(04):376–380, 1991.

[38] Nicolas Bonneel, Michiel Van De Panne, Sylvain Paris, and Wolfgang Heidrich. Displacement interpolation using Lagrangian mass transport. In Proceedings of the 2011 SIGGRAPH Asia conference, pages 1–12, 2011.

[39] Avijit Rakshit, Pradipta Bandyopadhyay, Joseph P Heindel, and Sotiris S Xantheas. Atlas of putative minima and low-lying energy networks of water clusters n= 3–25. The Journal of chemical physics, 151(21), 2019.

[40] R´emi Flamary, Nicolas Courty, Alexandre Gramfort, Mokhtar Z. Alaya, Aur´elie Boisbunon, Stanislas Chambon, Laetitia Chapel, Adrien Corenflos, Kilian Fatras, Nemo Fournier, L´eo Gautheron, Nathalie T.H. Gayraud, Hicham Janati, Alain Rakotomamonjy, Ievgen Redko, An- toine Rolet, Antony Schutz, Vivien Seguy, Danica J. Sutherland, Romain Tavenard, Alexander Tong, and Titouan Vayer. POT: Python Optimal Transport. Journal of Machine Learning Research, 22(78):1–8, 2021.

[41] R´emi Flamary, C´edric Vincent-Cuaz, Nicolas Courty, Alexandre Gramfort, Oleksii Kachaiev, Huy Quang Tran, Laur`ene David, Cl´ement Bonet, Nathan Cassereau, Th´eo Gnassounou, Eloi Tanguy, Julie Delon, Antoine Collas, Sonia Mazelet, Laetitia Chapel, Tanguy Kerdoncuff, Xizheng Yu, Matthew Feickert, Paul Krzakala, Tianlin Liu, and Eduardo Fernandes Monte- suma. POT Python Optimal Transport (version 0.9.5), 2024.

[42] Kiyotaka Y. Hara and Akihiko Kondo. ATP regulation in bioproduction. Microbial Cell

Factories, 14(1):198, 2015.

[43] Eri Kobayashi, Kei Yura, and Yoshinori Nagai. Distinct Conformation of ATP Molecule in

Solution and on Protein. BIOPHYSICS, 9:1–12, 2013.

[44] Michael Deininger, Elisabeth Buchdunger, and Brian J. Druker. The development of imatinib

as a therapeutic agent for chronic myeloid leukemia. Blood, 105(7):2640–2653, 2005.

[45] Nida Iqbal and Naveed Iqbal.

Imatinib: A Breakthrough of Targeted Therapy in Cancer.

Chemotherapy Research and Practice, 2014(1):357027, 2014.

26

[46] Tomohiko Okada, Kana Izumi, Shogo Kawaguchi, Chikako Moriyoshi, Takuya Fujimura, Ryo Sasai, and Makoto Ogawa. Important Roles of Water Clusters Confined in a Nanospace as Revealed by a Synchrotron X-ray Diffraction Study. Langmuir, 37(35):10469–10480, 2021. PMID: 34427085.

[47] Daniel L. Pouliquen. The biophysics of water in cell biology: perspectives on a keystone for both marine sciences and cancer research. Frontiers in Cell and Developmental Biology, Volume 12 - 2024, 2024.

27